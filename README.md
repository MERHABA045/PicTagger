# 📸PicTagger

サーバーや共有ドライブにアップロード、保存する大量の画像ファイルを整理しやすくするために、「被写体名」「カメラマン名」をファイル名に、タグのように付加するスクリプトです。 

---

## ✨Features（特長）✨

### 面倒な写真のタグ付けをスマートに
📂取材などで大量に撮影された写真を、編集部共有サーバーや外付けドライブに保存するときや、フォトアルバム用のセレクトなどで「被写体名や状況をファイル名に入れておきたい✨️」と思ったことはありませんか？ 

でも……💻️Finder上で一枚一枚開いて中身を確認して、ファイル名を入力して…… 。そんな作業を繰り返すのは面倒すぎてできない😩にんげんだもの。

この🔧ツールを使えば、写真をプレビューして中身を確認し、リストから被写体名を選ぶだけで
- ファイル名の先頭に被写体名
- ファイル名の末尾にカメラマン名  
を自動で付加します。  
例：📸IMG_1235.JPG→✏️Merhaba_IMG_1234_KF.JPG

### 被写体リストを自由にカスタマイズ。工夫次第でスピーディーに！
被写体名は`members.txt` に登録します。リネーム時は`fzf`（あいまい検索を可能にするツール）による入力補完対応なので  
- 例えば`m`と入力すると`Merhaba`など m を含む候補が絞り込まれます
- さらに2文字目3文字目とタイプすることでピンポイント検索が可能です
- ⬆️⬇️矢印キーで選んで、`Tab`キーで確定も可能です
- **2つ以上の被写体を選択、ファイル名に反映させることも可能です**

リストはタブ区切りの2列テキスト。2列目にゼッケン番号や別名を登録しておけば
- 「ゼッケン1️⃣2️⃣3️⃣で選手名を絞り込む」
- 「🏃‍♀️〇〇選手とペアのあの人🏃‍♂️、誰だっけ？」

そんな時も別キー検索で一発です。

さらに`Ceremony`、`Podium`、`Atmosphere`など状況名も登録しておけば🏆式典写真や雰囲気カットも分類できます。

### 恥ずかしいミスタイプや失礼な名前の間違いを撲滅
- 忙しい作業中は「Atmosphere」や「Miscellaneous」とかを❌打ち間違いしがち、にんげんだもの😅。ひどいときには毎回入力が違ってしまい、あとから修正しようにも検索を🤯 何度もするはめに
- 人名や社名の誤字は後で大問題😵🚨🔥

あらかじめ`members.txt`に正しい綴りで登録しておけば、入力補完で迷わず選択でき、**誤字を防げます**。

### ログ＆ UNDO（復元スクリプト）、バックアップで安心
- リネーム時に元ファイル名を残す命名規則なので、後からでもオリジナルを🔍 追跡可能
- 処理ログ（元ファイル名・被写体・カメラマン）も保存し、確認可能
- リネームを元に戻すundoスクリプトも自動生成。いつでもリネーム前の状態に復元
- 処理前に対象フォルダを丸ごと🔒バックアップ（ローカルモード） 

もしもの時に備えた仕組みが盛り込まれています。

- ⚠️注意：このスクリプトは自分用に作成し、その限りにおいては問題なく動作しましたが、このスクリプトを使用した結果、**トラブルや不具合が生じても責任は取れません**ことを理解していただいた上でご利用ください。  
同業の方（に限らず）、別の使用例や改変アイディアなど共有いただけると幸いです。

---

## 🔧Requirements（要件）🔧

- macOS（zsh）のターミナル（アプリケーション＞ユーティリティの中にターミナル.appがあります）
- fzfを使用しています。  
※インストールされていない場合は、Homebrewから（Homebrewがインストールされていない場合は、[https://brew.sh/ja/](https://brew.sh/ja/) からHomebrewをインストールの上） `brew install fzf` でインストールをしてください。

---

## 🚀Usage（使用方法）🚀
### 1 準備
- タグ付けしたい写真の入ったフォルダ用意
- フォルダと同じ階層に被写体リスト`members.txt`を配置してください（サンプルのmembers.txtを用意しました）  
例） /Volumes/Work/  
　　　　　　　├─ members.txt  
　　　　　　　└─ Photos/  
　　　　　　　　　　├─ IMG_0001.JPG  
　　　　　　　　　　└─ IMG_0002.JPG

`members.txt` はタブ区切りのテキストファイル  
Sato	1  
Suzuki	2  
Takahashi	3  
のように記載します。

### 2 実行
- ターミナルを起動
- ⚠️ 初めて使用する際には、スクリプトの実行権限の付与が必要になります。ターミナル上で  
**ユーザー名@ホスト（PC）名 ~ % chmod +x （ここにPicTagger.zshのファイルをドラッグ＆ドロップ）**  
してreturnキーを押してください。  
PicTagger.zshを移動させた場合は、再度実行権限を付与してください。

#### 🖥️通常（ローカル）モード
写真フォルダを丸ごとバックアップを作成するローカルPCやストレージを想定したモードです。
- 被写体名＋カメラマンイニシャル付与モード（基本仕様）  
ユーザー名@ホスト（PC）名 ~ % ./PicTagger.zsh /Volumes/...（タグ付けしたい写真の入ったフォルダのパス）  
を入力しリターンキーを押すことで実行できます。  
「PicTagger.zsh」のファイル名、指定したいフォルダ名を直接入力しなくても、それぞれ**ターミナル上にドラッグ＆ドロップ＋リターンキー**でスタートできます。
- 被写体名のみ付与モード（カメラマンイニシャルなし仕様）  
ユーザー名@ホスト（PC）名 ~ % ./PicTagger.zsh **-n** /Volumes/...（タグ付けしたい写真の入ったフォルダのパス）  
`-n`を加えることで、カメラマンのイニシャルを接尾辞として付与せず、被写体名のみ追加します。

#### ☁️ クラウドモード
クラウドストレージの写真フォルダをFinderから操作する場合を想定したモードです。クラウド上のフォルダを直接整理する際に便利です。バックアップファイルを作成せず、余計なファイルを増やさない・アップロードしないようにしました。  
また、写真フォルダとリネーム用の members.txt を対話型＋ドラッグ＆ドロップで指定し、扱いやすくしました。
- 実行にはクラウドモード `-c` を指定します  
ユーザー名@ホスト（PC）名 ~ % ./PicTagger.zsh -c  
実行後にリネームしたい写真フォルダとmembers.txtを画面の指示に従ってドラッグ＆ドロップしてください。
- クラウドモードでも **被写体名のみ付与モード（カメラマンイニシャルなし仕様）** `-n` の指定も可能です。
ユーザー名@ホスト（PC）名 ~ % ./PicTagger.zsh -c -n  

### 3 実行中の操作
ローカルモードでは、写真フォルダのバックアップが`photo_backup_YYYYMMDD_HHMMSS`というフォルダ名で作成されます。バックアップする画像ファイルの点数が多いと時間がかかりますが、そのままお待ち下さい。

1. **カメラマンイニシャルを選択** （イニシャルなし仕様ではスキップ）  
fzfが起動してカメラマンのイニシャルを選択画面が表示されたら、キーボードでアルファベットを入力、または⬆️⬇️上下キーで選択し`Return`キーで決定します。  
（カメラマンのイニシャルは`PicTagger.zsh`の8行目の`photographers= (...)`で設定できます）

2. **画像プレビューを1枚ずつ表示**  
QuickLook（mac の標準プレビュー）で写真が開きます。内容を確認できたら`Space`キーまたは`Esc`キーで閉じます

3. **被写体を選択**  
- fzfで被写体名を選択
- キーボードで文字を入力すると候補が絞り込まれ、`Tab`キーで確定
- 2つ以上の被写体を指定する場合は、`Tab`キーで1つ目を確定後、`Space`キーで絞り込みをクリアして、再度絞り込み→`Tab`キーで確定、その後`Return`キーで決定
- プレビューを見ても被写体がわからず、後で確認したい場合は「⚠️要確認」を選択しマーキングすることができます。  
⚠️ 何も選択せず`Return`すると、fzfのリストの最下部に表示されている被写体名が自動的に決定されます。サンプル`members.txt`ではデフォルトで「⚠️要確認」が一番下にあるので、`Return`だけ押すと「⚠️要確認」としてリネームされます。
- `ctrl + c` でいつでも中断できます。

4. **処理の終了**
#### 🖥️通常モード
- フォルダ内の写真のプレビューとリネームが終わると、写真フォルダ内に  
ログファイルが`log_YYYYMMDD_HHMMSS.txt`というファイル名で  
undo用スクリプトが`undo_rename_YYYYMMDD_HHMMSS.sh` というファイル名で生成されます。

#### ☁️ クラウドモード
- リネームが終了すると、指定したmembers.txtと同じフォルダ内に  
ログファイルが`log_YYYYMMDD_HHMMSS.txt`というファイル名で  
undo用スクリプトが`undo_rename_YYYYMMDD_HHMMSS.sh` というファイル名で生成されます。

ログファイルは、変更されたファイルの元のファイル名、被写体名、カメラマン名（基本仕様時）が記載されます。  
⏪undo用スクリプトを、ターミナル上で実行するとリネームされたファイル名がすべてリネーム前に復元されます。

### 4 中断後の再開（基本仕様のみ）
- 中断後に再び同じコマンドで実行（同じ写真フォルダを指定）すると
- すでにリネーム済みのファイルはスキップされ、未処理のファイルだけ再開します
- **ファイル名末尾のカメラマンイニシャルの有無**でリネーム済みかどうかを判定します

これにより、プレビュー確認によって、`members.txt`への被写体名の追加・削除・修正をしたい場合の中断とその後の再開に対応しました。
- ⚠️ カメラマンイニシャルなしモードでは、再開機能はなく、リネーム済みのファイルも再度リネーム対象になり、**被写体名が繰り返し接頭辞として追加**されます。

---

## 更新履歴
詳しくは [CHANGELOG.md](CHANGELOG.md) をご確認ください。