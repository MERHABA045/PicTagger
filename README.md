# 📸PicTagger

サーバーや共有ドライブにアップロード、保存する大量の画像ファイルを整理しやすくするために、「被写体名」「カメラマン名」をファイル名に、タグのように付加するスクリプトです。 

---

## ✨Features（特長）✨

### 面倒な写真のタグ付けをスマートに
📂取材などで大量に撮影された写真を、編集部共有サーバーや外付けドライブに保存するときや、フォトアルバム用のセレクトなどで「被写体名や状況をファイル名に入れておきたい✨️」と思ったことはありませんか？ 

でも……💻️Finder上で一枚一枚開いて中身を確認して、ファイル名を入力して…… 。そんな作業を繰り返すのは面倒すぎてできない😩にんげんだもの。

この🔧ツールを使えば、写真をプレビューして中身を確認し、リストから被写体名を選ぶだけで
- ファイル名の先頭に被写体名
- ファイル名の末尾にカメラマン名
を自動で付加します。  
例：📸IMG_1235.JPG→✏️Merhaba_IMG_1234_KF.JPG

### 被写体リストを自由にカスタマイズ。工夫次第でスピーディーに！
被写体名は`members.txt` に登録します。リネーム時は`fzf`（あいまい検索を可能にするツール）による入力補完対応なので  
- 例えば`m`と入力すると`Merhaba`など m を含む候補が絞り込まれます
- さらに2文字目3文字目とタイプすることでピンポイント検索が可能です
- ⬆️⬇️矢印キーで選んで、`Tab`キーで確定も可能です
- **2つ以上の被写体を選択、ファイル名に反映させることも可能です**

リストはタブ区切りの2列テキスト。2列目にゼッケン番号や別名を登録しておけば
- 「ゼッケン1️⃣2️⃣3️⃣で選手名を絞り込む」
- 「🏃‍♀️〇〇選手とペアのあの人🏃‍♂️、誰だっけ？」

そんな時も別キー検索で一発です。

さらに`Ceremony`、`Podium`、`Atmosphere`など状況名も登録しておけば🏆式典写真や雰囲気カットも分類できます。

### 恥ずかしいミスタイプや失礼な名前の間違いを撲滅
- 忙しい作業中は「Atmosphere」や「Miscellaneous」とかを❌打ち間違いしがち、にんげんだもの😅。ひどいときには毎回入力が違ってしまい、あとから修正しようにも検索を🤯 何度もするはめに
- 人名や社名の誤字は後で大問題😵🚨🔥

あらかじめ`members.txt`に正しい綴りで登録しておけば、入力補完で迷わず選択でき、**誤字を防げます**。

### バックアップ＆ログで安心
- リネーム時に元ファイル名を残す命名規則なので、後からでもオリジナルを🔍 追跡可能
- さらに、リネーム前に対象フォルダを丸ごと🔒バックアップ
- 処理ログ（元ファイル名・被写体・カメラマン）も保存し、確認可能

もしもの時に備えた仕組みが盛り込まれています。

- ⚠️注意：このスクリプトは自分用に作成し、その限りにおいては問題なく動作しましたが、このスクリプトを使用した結果、**トラブルや不具合が生じても責任は取れません**ことを理解していただいた上でご利用ください。
- 同業の方（に限らず）、別の使用例や改変アイディアなど共有いただけると幸いです。

---

## 🔧Requirements（要件）🔧

- macOS（zsh）のターミナル（アプリケーション＞ユーティリティの中にターミナル.appがあります）
- fzfを使用しています。  
※インストールされていない場合は、Homebrewから（Homebrewがインストールされていない場合は、[https://brew.sh/ja/](https://brew.sh/ja/) からHomebrewをインストールの上） `brew install fzf` でインストールをしてください。

---

## 🚀Usage（使用方法）🚀
### 1 準備
- タグ付けしたい写真の入ったフォルダ用意
- フォルダと同じ階層に被写体リスト`members.txt`を配置してください（サンプルのmembers.txtを用意しました）
例） /Volumes/Work/  
　　　　　　　├─ members.txt  
　　　　　　　└─ Photos/  
　　　　　　　　　　├─ IMG_0001.JPG  
　　　　　　　　　　└─ IMG_0002.JPG

`members.txt` はタブ区切りのテキストファイル  
Sato	1  
Suzuki	2  
Takahashi	3  
のように記載します。

### 2 実行
- ターミナルを起動し、  （⚠️ 初めて起動する時には以下の※1を参照してください）  
**ユーザー名@ホスト（PC）名 ~ % ./PicTagger.zsh /Volumes/...（タグ付けしたい写真の入ったフォルダのパス）**  
を入力しリターンキーを押すことで実行できます。  
「PicTagger.zsh」のファイル名、指定したいフォルダ名を直接入力しなくても、それぞれターミナル上にドラッグ＆ドロップ＋リターンキーでスタートできます。

- ※1 初めて使用する際には、スクリプトの実行権限の付与が必要になります。ターミナル上で  
**ユーザー名@ホスト（PC）名 ~ % chmod +x （ここにPicTagger.zshのファイルをドラッグ＆ドロップ）**  
してreturnキーを押してください。  
PicTagger.zshを移動させた場合は、再度実行権限を付与してください。

### 3 実行中の操作
1. **カメラマンイニシャルを選択**  
写真フォルダのバックアップが`photo_backup_YYYYMMDD_HHMMSS`というフォルダ名で作成されると  
fzfが起動します。キーボードでアルファベットを入力または⬆️⬇️上下キーで選択し`Return`キーで決定します。  
（カメラマンのイニシャルは`PicTagger.zsh`の10行目の`photographers= (...)`で設定できます）

2. **画像プレビューを1枚ずつ表示**  
QuickLook（mac の標準プレビュー）で写真が開きます。内容を確認できたら`Space`キーまたは`Esc`キーで閉じます

3. **被写体を選択**  
- fzfで被写体名を選択
- キーボードで文字を入力すると候補が絞り込まれ、`Tab`キーで確定
- 2つ以上の被写体を指定する場合は、`Tab`キーで1つ目を確定後、`Space`キーで絞り込みをクリアして、再度絞り込み→`Tab`キーで確定、その後`Return`キーで決定
- プレビューを見ても被写体がわからず、後で確認用したい場合は「⚠️要確認」を選択しマーキングすることができます。  
⚠️ 何も選択せず`Return`すると、fzfのリストの最下部に表示されている被写体名が自動的に決定されます。サンプル`members.txt`ではデフォルトで「⚠️要確認」が一番下にあるので、`Return`だけ押すと「⚠️要確認」としてリネームされます。
- `ctrl + c` でいつでも中断できます。

4. **処理の終了**
- フォルダ内の写真のプレビューとリネームが終わると以下のような表示がターミナル上でされます  
✅ 処理完了！合計 `n` ファイルをリネーム  
- 写真フォルダ内にログファイルが`log_YYYYMMDD_HHMMSS.txt`というファイル名で出力されます。  
ログには、オリジナルの画像ファイル名、選択した被写体名、カメラマンイニシャルが記録されます。

### 4 中断後の再開
- 中断後に再び同じコマンドで実行（同じ写真フォルダを指定）すると
- すでにリネーム済みのファイルはスキップされ、未処理のファイルだけ再開します
- **ファイル名末尾のカメラマンイニシャルの有無**でリネーム済みかどうかを判定します

これにより、プレビュー確認によって、`members.txt`への被写体名の追加・削除・修正をしたい場合の中断とその後の再開に対応しました。

